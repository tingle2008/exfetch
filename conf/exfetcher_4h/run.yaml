coinbase_spot_ticker:
  loglevel: 30 #info:20 w:30 e:40 C:50, both fetcher and injector loglevel
  api: 'wss://ws-feed.exchange.coinbase.com'
  subscribe: >
    {
    "type": "subscribe",
    "product_ids": [
        "BTC-USD",
        "ETH-USD"
    ],
    "channels": [
        {   
            "name": "ticker",
            "product_ids": [
                "BTC-USD",
                "ETH-USD"
            ]
        }
    ]
    }
  jdata: ''
  jdata_wanted:
    - 'product_id'
    - 'price'
    - 'volume_24h'
    - 'volume_30d'
    - 'best_bid'
    - 'best_ask'
    - 'side'
    - 'time'
    - 'trade_id'
    - 'last_size'
  ins_sub_query: >
    o->>'product_id' as "product_id",
    (o->>'price')::float as "price",
    (o->>'volume_24h')::float as "volume_24h",
    (o->>'volume_30d')::float as "volume_30d",
    (o->>'best_bid')::float as "best_bid",
    (o->>'best_ask')::float as "best_ask",
    o->>'side' as "side",
    (o->>'time')::timestamp as "time" ,
    (o->>'trade_id')::integer as "trade_id",
    (o->>'last_size')::float  as "last_size"

bitmex_instrument:
  api: 'https://www.bitmex.com'
  apitype: 'rest'
  intval: 2
  subscribe:
    - '/api/v1/instrument': 'GET'
      symbol: 'XBT'
      reverse: 'false'
    - '/api/v1/instrument': 'GET'
      symbol: 'ETH'
      reverse: 'false'
  jdata: ''
  jdata_wanted:
    - 'symbol'
    - 'markPrice'
    - 'openInterest'
    - 'openValue'
    - 'fundingRate'
  ins_sub_query: >
    (o->>'symbol')::varchar as "symbol",
    (o->>'openInterest')::integer as "openInterest",
    (o->>'openValue')::bigint as "openValue",
    (o->>'markPrice')::float as "markPrice",
    (o->>'midPrice')::float as "midPrice",
    (o->>'vwap')::float as "vwap",
    (o->>'fundingRate')::float as "fundingRate",
    (o->>'indicativeFundingRate')::float as "indicativeFundingRate",
    (o->>'timestamp')::timestamp as "ts"

bitstamp_spot_btcusd:
  api: 'wss://ws.bitstamp.net'
  subscribe: >
     { 
       "event": "bts:subscribe",
        "data": {
                "channel": "live_trades_btcusd"
        }
     }
  jdata_wanted:
    - 'timestamp'
    - 'amount'
    - 'price'
  dst_table: "bitstamp_spot"
  ins_sub_query: >
    to_timestamp((o->>'timestamp')::bigint) as "ts",
    (o->>'amount')::float as "amount",
    (o->>'price')::float as "price",
    (o->>'type')::smallint as "type",
    'BTCUSD' as "symbol"
 

bitstamp_spot_ethusd:
  api: 'wss://ws.bitstamp.net'
  subscribe: >
     { 
       "event": "bts:subscribe",
        "data": {
                "channel": "live_trades_ethusd"
        }
     }
  jdata_wanted:
    - 'timestamp'
    - 'amount'
    - 'price'
  dst_table: "bitstamp_spot"
  ins_sub_query: >
    to_timestamp((o->>'timestamp')::bigint) as "ts",
    (o->>'amount')::float as "amount",
    (o->>'price')::float as "price",
    (o->>'type')::smallint as "type",
    'ETHUSD' as "symbol"
 
deribit_book_summary_options:
  api: 'https://www.deribit.com/api/v2/public/'
  apitype: 'rest'
  jdata: 'result'
  jdata_wanted:
    - 'volume'
    - 'base_currency'
  intval: 600
  subscribe:
    - 'get_book_summary_by_currency': 'GET'
      currency: 'BTC'
      kind: 'option'
    - 'get_book_summary_by_currency': 'GET'
      currency: 'ETH'
      kind: 'option'
  exchange: 'deribit'
  ins_sub_query: >
    (o->>'volume')::float as "volume",
    (o->>'underlying_price')::float as "underlying_price",
    (o->>'underlying_index')::varchar as "underlying_index",
    (o->>'quote_currency')::varchar as "quote_currency",
    (case when ((o->>'price_change')::varchar = 'null') then NULL else (o->>'price_change')::float end) as "price_change",
    (case when ((o->>'open_interest')::varchar = 'null') then NULL else (o->>'open_interest')::float end) as "open_interest",
    (case when ((o->>'mid_price')::varchar = 'null') then NULL else (o->>'mid_price')::float end) as "mid_price",
    (case when ((o->>'mark_price')::varchar = 'null') then NULL else (o->>'mark_price')::float end) as "mark_price",
    (case when ((o->>'low')::varchar = 'null') then NULL else (o->>'low')::float end) as "low",
    (case when ((o->>'last')::varchar = 'null') then NULL else (o->>'last')::float end) as "last",
    (case when ((o->>'interest_rate')::varchar = 'null') then NULL else (o->>'interest_rate')::float end) as "interest_rate",
    (o->>'instrument_name')::varchar as "instrument_name",
    (case when ((o->>'high')::varchar = 'null') then NULL else (o->>'high')::float end) as "high",
    (case when ((o->>'estimated_delivery_price')::varchar = 'null') then NULL else (o->>'estimated_delivery_price')::float end) as "estimated_delivery_price",
    to_timestamp(((o->>'creation_timestamp')::bigint/(1000 * 600))::bigint * 600) as "creation_timestamp",
    (case when ((o->>'bid_price')::varchar = 'null') then NULL else (o->>'bid_price')::float end) as "bid_price",
    o->>'base_currency' as "base_currency",
    (case when ((o->>'ask_price')::varchar = 'null') then NULL else (o->>'ask_price')::float end) as "ask_price"
